<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.2/css/bootstrap-grid.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.min.js">
</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>弹幕</title>
</head>
<style type="text/css">
#main{
	width:95%;
	height:500px;
	margin:20px auto;
	border:1px solid;
	background:#ddd;
	overflow:hidden;
	position:relative;
}
.inpp{
	margin:20px auto;
	text-align:center;
}
input{
	width:500px;
	font-size:25px;
}
.buttongroup{
	margin:4px auto;
	width:500px;
}
button{
	border:1px solid;
	background:#fff;
	width:200px;
	font-size:30px;
  	bottom:45px;
	border-radius:3px;
}
.btn1{
  	left:480px;
	border-color:#F00;
	color:#F00;
}
.btn2{
	border-color:#666;
	color:#666;
	right:480px;
}
.dm_message{
	position:absolute;
	float:left;
	color:#F00;
	font-size:30px;
	left:1290px;
}
</style>
<body>
<div id="main"><!--height:0-498px width:0-1296px-->
<div class="dm_message" id="dm0"></div>
<div class="dm_message" id="dm1"></div>
<div class="dm_message" id="dm2"></div>
<div class="dm_message" id="dm3"></div>
<div class="dm_message" id="dm4"></div>
<div class="dm_message" id="dm5"></div>
<div class="dm_message" id="dm6"></div>
<div class="dm_message" id="dm7"></div>
<div class="dm_message" id="dm8"></div>
<div class="dm_message" id="dm9"></div>
<div class="dm_message" id="dm10"></div>
<div class="dm_message" id="dm11"></div>
</div>
<div class="inpp">
	<input type="text" id="inputValue" placeholder="说点什么吧" onkeydown="enterE()"/>
    <div class="buttongroup">
	<button class="btn1" id="Btn1" onclick='lunh()'>发射</button>
  	<button class="btn2" onclick="clearR()">清屏</button>
    </div>
</div>
</body>
<script>
	window.onload=function(){
            clearInterval(timer);//清除定时器  
            for(var i = 0;i<12;i++){  
                setTimeout('lunch()',1000*Math.ceil(Math.random()*30))//给弹幕随机加一个延迟  
            }   
            timer=setInterval('scrollL()',5);//开启定时器 
	};
	var c=-1;
	var s;
	var leftT;
	var words = ["富强","民主","文明","和谐","自由","平等","公正","法治","爱国","敬业","诚信","友善"];
	var timer=null;
	function idI(){//选择不同的id来使用
		c=(c+1)%12;
		elemid="dm"+c;
		console.log(elemid);
		return elemid
	}
	function enterE(){
  if (event.keyCode == 13)
  		lunh();
	}
	function lunch(){//点击发射按钮的操作
		s=idI();
		if(!document.getElementById(s))//检查id是否存在，不存在则创建
		{
			var div = document.createElement('div');
			var yuan=document.getElementById('main');
			div.className="dm_message";
			div.id=s;
			yuan.insertBefore(div,yuan.lastChild);
			console.log(s);
		}
		document.getElementById(s).innerHTML=words[c];//将文本框中输入的文字传入对应该上述id的div
			

		var topZ=Math.ceil(Math.random()*498)+"px";
		var a1=document.getElementById(s).style.top=topZ;//div的高度随机
		
		document.getElementById(s).style.left='1229px';
		document.getElementById(s).style.color=colorC();
		leftT=document.getElementById(s).offsetLeft;//初始化div
		setTimeout('lunch()',1000+1000*Math.ceil(Math.random()*30))
	}
	
	function lunh(){//点击发射按钮的操作
		var temp=document.getElementById("inputValue").value;
			document.getElementById(s).innerHTML=temp;
			document.getElementById("inputValue").value='';

		var topZ=Math.ceil(Math.random()*498)+"px";
		var a1=document.getElementById(s).style.top=topZ;//div的高度随机
		
		document.getElementById(s).style.left='1229px';
		document.getElementById(s).style.color=colorC();
		leftT=document.getElementById(s).offsetLeft;//初始化div
	}
	
	var a=['160','160','160','160','160','160','160','160','160','160','160','160'];
	function scrollL(){
		for(i=0;i<12;i++){
			//alert(a[i]);
			a[i]=document.getElementById('dm'+i).offsetLeft;
			if(a[i]>0){
				document.getElementById('dm'+i).style.left=(a[i]-1)+'px';
				a[i]=a[i]-1;
				//console.log(a[i]);
			}
			else{
				document.getElementById('dm'+i).style.color='#ddd';
			}
		}
	}
	
	function II(){
		if(leftT>0){
		console.log(leftT);
		leftT=leftT-1
		document.getElementById(s).style.left=(leftT)+'px';
		
	}
	}
	function colorC(){//设置div的颜色
		r=Math.ceil(Math.random()*255);
		g=Math.ceil(Math.random()*255);
		b=Math.ceil(Math.random()*255);
		return 'rgb('+r+','+g+','+b+")";
	}
	
	function clearR(){
		for(i=0;i<15;i++){
			iA='dm'+i;
			if(document.getElementById(iA))
				document.getElementById(iA).remove();
		}
		words=null;
	}
	
</script>
</html>
